# 注册功能测试报告

**测试日期**: 2025-12-03
**测试对象**: 学习打卡系统 - 用户注册模块
**测试工具**: JUnit 5, MockMvc, Spring Boot Test

## 1. 测试概览
本次测试旨在全面验证用户注册功能的正确性、健壮性和安全性。测试范围覆盖了正常注册流程、输入校验、异常处理（重复数据）、以及并发注册场景。

## 2. 测试用例与结果

| ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|---|---|---|---|---|---|
| TC01 | **正常注册流程** | 1. 构造合法的注册请求（用户名、密码、邮箱）。<br>2. 发送 POST 请求至 `/api/auth/register`。 | 返回状态码 200，提示"Register success"，数据库中生成新用户，密码已加密。 | 返回 200，数据库查询到用户，密码为 BCrypt 哈希值。 | ✅ **通过** |
| TC02 | **重复用户名注册** | 1. 注册用户 A。<br>2. 尝试使用相同用户名再次注册。 | 返回状态码 400，错误信息 "Username already exists"。 | 返回 400，提示 "Username already exists"。 | ✅ **通过** |
| TC03 | **重复邮箱注册** | 1. 注册用户 A（邮箱 E）。<br>2. 尝试使用相同邮箱 E 注册新用户。 | 返回状态码 400，错误信息 "Email already exists"。 | 返回 400，提示 "Email already exists"。 | ✅ **通过** |
| TC04 | **输入验证 (无效输入)** | 1. 尝试注册空用户名。<br>2. 尝试注册短密码 (<6位)。<br>3. 尝试注册无效格式邮箱。 | 均返回状态码 400，并包含具体的校验错误信息。 | 返回 400，错误信息包含 "Username is required", "Email should be valid" 等。 | ✅ **通过** |
| TC05 | **并发注册测试** | 1. 模拟 10 个线程同时使用相同信息发起注册请求。 | 系统稳定运行，最终只有一个请求成功写入数据库（或应用层拦截）。 | 测试通过，应用层及数据库唯一约束有效防止了脏数据。 | ✅ **通过** |

## 3. 问题发现与修复记录

在测试过程中发现了以下问题并已完成修复：

1.  **输入校验未生效**
    *   **现象**: 提交非法数据（如空用户名）后端仍返回 200 成功。
    *   **原因**: 项目缺少 `spring-boot-starter-validation` 依赖，导致 DTO 上的校验注解被忽略。
    *   **修复**: 在 `pom.xml` 中添加了 validation 依赖。

2.  **数据库连接异常**
    *   **现象**: 测试启动失败，提示 `Access denied` 或 `Unknown database`。
    *   **修复**: 修正了配置文件中的数据库密码，并手动执行了数据库初始化脚本 (`schema.sql`)。

3.  **测试数据干扰**
    *   **现象**: 多次运行测试时，因数据残留导致 "正常注册" 用例失败。
    *   **修复**: 在测试类上添加 `@Transactional` 注解以自动回滚数据，并优化测试用例使用随机 UUID 生成唯一用户名。

## 4. 系统安全性与性能评估

*   **安全性**:
    *   **密码存储**: 使用 `BCryptPasswordEncoder` 进行强哈希加密，无明文存储风险。
    *   **SQL注入**: 使用 MyBatis Plus (基于预编译语句) 防止了常规 SQL 注入。
    *   **数据一致性**: 数据库层面的 `UNIQUE` 索引确保了用户名和邮箱的唯一性。

*   **性能**:
    *   注册接口响应迅速（测试环境下 < 200ms）。
    *   邮件发送目前通过 `Thread.sleep` 模拟网络延迟，建议后续优化为异步处理。

## 5. 改进建议

1.  **异步邮件发送**: 当前邮件发送逻辑在主线程中执行，会阻塞注册响应。建议使用 Spring `@Async` 或消息队列将邮件发送任务异步化。
2.  **验证码机制**: 为了防止恶意批量注册，建议在注册接口增加图形验证码或邮箱验证码校验。
3.  **密码强度策略**: 当前仅校验了长度，建议增加对数字、字母、特殊字符混合的强制要求。
